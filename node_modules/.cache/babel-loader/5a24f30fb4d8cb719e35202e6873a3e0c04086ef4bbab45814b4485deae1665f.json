{"ast":null,"code":"import{useOrganizationList,useUser}from'@clerk/clerk-react';import React from'react';import{useNavigate}from'react-router-dom';import'./ExpenseList.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ExpenseList=()=>{var _userMemberships$data;const navigate=useNavigate();const{isLoaded:isUserLoaded,user}=useUser();const{isLoaded:isOrgLoaded,userMemberships}=useOrganizationList({userMemberships:{infinite:true}});// Debug memberships data\nReact.useEffect(()=>{if(isOrgLoaded&&userMemberships!==null&&userMemberships!==void 0&&userMemberships.data){console.log('User Memberships:',userMemberships.data.map(m=>({orgName:m.organization.name,role:m.role,publicMetadata:m.organization.publicMetadata})));}},[isOrgLoaded,userMemberships]);const handleGroupClick=organizationId=>{navigate(\"/group/\".concat(organizationId));};const handleDeleteGroup=async(organizationId,event)=>{event.stopPropagation();// Prevent navigation when clicking delete\nif(!window.confirm('Are you sure you want to delete this group? This action cannot be undone.')){return;}try{console.log('Original organization ID:',organizationId);// First delete the organization from Clerk\nconst organization=userMemberships.data.find(m=>m.organization.id===organizationId);if(!organization){throw new Error('Organization not found');}// Delete from Clerk first\nawait organization.organization.destroy();console.log('Organization deleted from Clerk');// Extract just the ID part after the last slash if present\nconst idPart=organizationId.includes('/')?organizationId.split('/').pop():organizationId;console.log('ID part:',idPart);// Clean the organization ID - remove 'org_' prefix and any special characters\nconst cleanOrgId=idPart.replace(/^org_/,'').replace(/[^a-zA-Z0-9]/g,'');console.log('Cleaned organization ID:',cleanOrgId);// Then delete from our database\nconst response=await fetch(\"http://localhost:3005/api/groups/\".concat(cleanOrgId),{method:'DELETE',headers:{'Content-Type':'application/json','user-id':user.id}});console.log('Delete response:',{status:response.status,statusText:response.statusText,ok:response.ok});if(!response.ok){const errorText=await response.text();console.error('Error response text:',errorText);let errorMessage;try{const errorData=JSON.parse(errorText);errorMessage=errorData.error||'Failed to delete group';}catch(e){errorMessage='Failed to delete group: Invalid server response';}throw new Error(errorMessage);}const result=await response.text();let parsedResult;try{parsedResult=result?JSON.parse(result):{success:true};}catch(e){console.warn('Could not parse response as JSON:',result);parsedResult={success:true};}console.log('Delete result:',parsedResult);// Show success message\nalert('Group deleted successfully!');// Refresh the page to update the list\nwindow.location.reload();}catch(err){console.error('Error deleting group:',err);alert(err.message);}};if(!isUserLoaded||!isOrgLoaded){return/*#__PURE__*/_jsx(\"div\",{className:\"expense-list-container\",children:\"Loading organizations...\"});}if(!(userMemberships!==null&&userMemberships!==void 0&&(_userMemberships$data=userMemberships.data)!==null&&_userMemberships$data!==void 0&&_userMemberships$data.length)){return/*#__PURE__*/_jsxs(\"div\",{className:\"expense-list-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Organizations\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtitle\",children:\"You haven't joined any organizations yet.\"}),/*#__PURE__*/_jsx(\"p\",{className:\"subtitle\",children:\"Create or join an organization to get started!\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"expense-list-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Organizations\"}),/*#__PURE__*/_jsx(\"div\",{className:\"expense-list\",children:userMemberships.data.map(membership=>{// Debug each membership role\nconsole.log(\"Organization \".concat(membership.organization.name,\" role:\"),membership.role);const isAdmin=membership.role==='org:admin';return/*#__PURE__*/_jsx(\"div\",{className:\"expense-item\",onClick:()=>handleGroupClick(membership.organization.id),children:/*#__PURE__*/_jsx(\"div\",{className:\"expense-info\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"expense-header\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{children:membership.organization.name}),/*#__PURE__*/_jsxs(\"p\",{className:\"role-text\",children:[\"Role: \",membership.role]}),/*#__PURE__*/_jsxs(\"p\",{children:[membership.organization.membersCount,\" members\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"expense-date\",children:[\"Joined \",new Date(membership.createdAt).toLocaleDateString()]})]}),isAdmin&&/*#__PURE__*/_jsx(\"button\",{className:\"delete-group-btn\",onClick:e=>handleDeleteGroup(membership.organization.id,e),children:\"Delete Group\"})]})})},membership.organization.id);})})]});};export default ExpenseList;","map":{"version":3,"names":["useOrganizationList","useUser","React","useNavigate","jsx","_jsx","jsxs","_jsxs","ExpenseList","_userMemberships$data","navigate","isLoaded","isUserLoaded","user","isOrgLoaded","userMemberships","infinite","useEffect","data","console","log","map","m","orgName","organization","name","role","publicMetadata","handleGroupClick","organizationId","concat","handleDeleteGroup","event","stopPropagation","window","confirm","find","id","Error","destroy","idPart","includes","split","pop","cleanOrgId","replace","response","fetch","method","headers","status","statusText","ok","errorText","text","error","errorMessage","errorData","JSON","parse","e","result","parsedResult","success","warn","alert","location","reload","err","message","className","children","length","membership","isAdmin","onClick","membersCount","Date","createdAt","toLocaleDateString"],"sources":["C:/Users/shaur/OneDrive/Desktop/AiProject/my-react-app/src/components/ExpenseList.jsx"],"sourcesContent":["import { useOrganizationList, useUser } from '@clerk/clerk-react';\nimport React from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport './ExpenseList.css';\n\nconst ExpenseList = () => {\n  const navigate = useNavigate();\n  const { isLoaded: isUserLoaded, user } = useUser();\n  const { \n    isLoaded: isOrgLoaded, \n    userMemberships \n  } = useOrganizationList({\n    userMemberships: {\n      infinite: true\n    }\n  });\n\n  // Debug memberships data\n  React.useEffect(() => {\n    if (isOrgLoaded && userMemberships?.data) {\n      console.log('User Memberships:', userMemberships.data.map(m => ({\n        orgName: m.organization.name,\n        role: m.role,\n        publicMetadata: m.organization.publicMetadata\n      })));\n    }\n  }, [isOrgLoaded, userMemberships]);\n\n  const handleGroupClick = (organizationId) => {\n    navigate(`/group/${organizationId}`);\n  };\n\n  const handleDeleteGroup = async (organizationId, event) => {\n    event.stopPropagation(); // Prevent navigation when clicking delete\n\n    if (!window.confirm('Are you sure you want to delete this group? This action cannot be undone.')) {\n      return;\n    }\n\n    try {\n      console.log('Original organization ID:', organizationId);\n      \n      // First delete the organization from Clerk\n      const organization = userMemberships.data.find(m => m.organization.id === organizationId);\n      if (!organization) {\n        throw new Error('Organization not found');\n      }\n\n      // Delete from Clerk first\n      await organization.organization.destroy();\n      console.log('Organization deleted from Clerk');\n\n      // Extract just the ID part after the last slash if present\n      const idPart = organizationId.includes('/') ? organizationId.split('/').pop() : organizationId;\n      console.log('ID part:', idPart);\n      \n      // Clean the organization ID - remove 'org_' prefix and any special characters\n      const cleanOrgId = idPart.replace(/^org_/, '').replace(/[^a-zA-Z0-9]/g, '');\n      console.log('Cleaned organization ID:', cleanOrgId);\n\n      // Then delete from our database\n      const response = await fetch(`http://localhost:3005/api/groups/${cleanOrgId}`, {\n        method: 'DELETE',\n        headers: {\n          'Content-Type': 'application/json',\n          'user-id': user.id\n        }\n      });\n\n      console.log('Delete response:', {\n        status: response.status,\n        statusText: response.statusText,\n        ok: response.ok\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Error response text:', errorText);\n        \n        let errorMessage;\n        try {\n          const errorData = JSON.parse(errorText);\n          errorMessage = errorData.error || 'Failed to delete group';\n        } catch (e) {\n          errorMessage = 'Failed to delete group: Invalid server response';\n        }\n        \n        throw new Error(errorMessage);\n      }\n\n      const result = await response.text();\n      let parsedResult;\n      try {\n        parsedResult = result ? JSON.parse(result) : { success: true };\n      } catch (e) {\n        console.warn('Could not parse response as JSON:', result);\n        parsedResult = { success: true };\n      }\n      \n      console.log('Delete result:', parsedResult);\n\n      // Show success message\n      alert('Group deleted successfully!');\n\n      // Refresh the page to update the list\n      window.location.reload();\n    } catch (err) {\n      console.error('Error deleting group:', err);\n      alert(err.message);\n    }\n  };\n\n  if (!isUserLoaded || !isOrgLoaded) {\n    return <div className=\"expense-list-container\">Loading organizations...</div>;\n  }\n\n  if (!userMemberships?.data?.length) {\n    return (\n      <div className=\"expense-list-container\">\n        <h1>Organizations</h1>\n        <p className=\"subtitle\">You haven't joined any organizations yet.</p>\n        <p className=\"subtitle\">Create or join an organization to get started!</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"expense-list-container\">\n      <h1>Organizations</h1>\n      <div className=\"expense-list\">\n        {userMemberships.data.map((membership) => {\n          // Debug each membership role\n          console.log(`Organization ${membership.organization.name} role:`, membership.role);\n          \n          const isAdmin = membership.role === 'org:admin';\n          \n          return (\n            <div \n              key={membership.organization.id} \n              className=\"expense-item\"\n              onClick={() => handleGroupClick(membership.organization.id)}\n            >\n              <div className=\"expense-info\">\n                <div className=\"expense-header\">\n                  <div>\n                    <h3>{membership.organization.name}</h3>\n                    <p className=\"role-text\">Role: {membership.role}</p>\n                    <p>{membership.organization.membersCount} members</p>\n                    <p className=\"expense-date\">\n                      Joined {new Date(membership.createdAt).toLocaleDateString()}\n                    </p>\n                  </div>\n                  {isAdmin && (\n                    <button \n                      className=\"delete-group-btn\"\n                      onClick={(e) => handleDeleteGroup(membership.organization.id, e)}\n                    >\n                      Delete Group\n                    </button>\n                  )}\n                </div>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default ExpenseList; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}